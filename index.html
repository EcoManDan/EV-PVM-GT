<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PVM Waste Sort Game</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
    .hidden { display: none; }
    #content, #introSection, #gameContainer, #finalSection { display: none; }
    #diversionGrid, #answers { display: grid; gap: 20px; max-width: 800px; margin: 20px auto; }
    #diversionGrid { grid-template-columns: repeat(4,1fr); }
    #answers { grid-template-columns: repeat(4,1fr); justify-items: center; }
    .diversionCard, .answerButton { background:none; border:none; cursor:pointer; text-align:center; }
    .diversionCard img, .answerButton img { width:100px; height:100px; object-fit:cover; display:block; margin:0 auto; }
    .label { margin-top:5px; font-size:0.9em; font-weight:bold; }
    #questionImage { width:400px; height:300px; object-fit:cover; margin-bottom:10px; }
    #feedback { margin-top:10px; font-weight:bold; }
    #score { margin-top:20px; font-size:1.2em; }
    table { width:80%; border-collapse:collapse; margin:20px auto; }
    th, td { border:1px solid #333; padding:8px; text-align:center; }
  </style>
</head>
<body>
  <div id="languageSelection">
    <h2>Select Language / Sélectionnez la langue</h2>
    <button id="langEnglish">English</button>
    <button id="langFrench">Français</button>
  </div>

  <div id="content">
    <div id="userInfo">
      <h2 id="formHeading"></h2>
      <form id="userInfoForm">
        <label id="labelFirstName" for="firstName"></label>
        <input type="text" id="firstName" required><br><br>
        <label id="labelLastName" for="lastName"></label>
        <input type="text" id="lastName" required><br><br>
        <label id="labelEmail" for="email"></label>
        <input type="email" id="email" required><br><br>
        <button type="submit" id="submitInfo"></button>
      </form>
    </div>

    <div id="introSection">
      <h2 id="introHeading"></h2>
      <div id="introPreamble"></div>
      <div id="diversionGrid"></div>
      <button id="introContinue"></button>
    </div>

    <div id="gameContainer">
      <h2 id="questionCounter"></h2>
      <img id="questionImage" src="" alt="Waste item">
      <h3 id="questionText"></h3>
      <div id="answers"></div>
      <div id="feedback"></div>
      <button id="nextButton" class="hidden"></button>
      <div id="score"></div>
    </div>

    <div id="finalSection">
      <h2 id="gameOverHeading"></h2>
      <div id="finalScore"></div>
      <div id="thankYouMsg"></div>
      <h3 id="leaderboardHeading"></h3>
      <table id="leaderboardTable">
        <thead><tr><th>Name</th><th>Email</th><th>Score</th></tr></thead>
        <tbody></tbody>
      </table>
      <div id="submissionStatus"></div>
    </div>
  </div>

  <script>
    const submitUrl = 'https://ev-pvm-gt.infinityfreeapp.com/submit.php';
    const leaderboardUrl = 'https://ev-pvm-gt.infinityfreeapp.com/leaderboard.php';

    const languageData = {
      en: {
        formHeading: 'Please enter your information:',
        labelFirstName: 'First Name:',
        labelLastName: 'Last Name:',
        labelEmail: 'ECCC Email Address:',
        submitInfo: 'Continue',
        introHeading: 'Waste Diversion Options',
        introPreamble: `<p>Building-wide compost is finally available at Place Vincent Massey! You now have better options to divert your office waste!</p>
<ul><li>Diverting at least 75% of operational and plastic waste from the landfill</li><li>Reducing GHG emissions by at least 40% for federal facilities</li></ul>
<p>This is totally doable, but we need your help putting waste into the right place!</p>`,
        introContinue: 'Start Quiz',
        questionPrefix: 'Where should the following item be sorted? ',
        nextButton: 'Next',
        scoreLabel: 'Score: ',
        gameOverHeading: 'Game Over!',
        finalScore: 'Your final score is: ',
        thankYouMsg: 'Thank you for playing!',
        leaderboardHeading: 'Leaderboard',
        submissionStatusSuccess: 'Your information was submitted successfully.',
        submissionStatusError: 'Error submitting information.',
        correctText: 'Correct!',
        incorrectText: 'Incorrect! The correct answer is: '
      },
      fr: {
        formHeading: 'Veuillez entrer vos informations :',
        labelFirstName: 'Prénom :',
        labelLastName: 'Nom :',
        labelEmail: 'Courriel ECCC :',
        submitInfo: 'Continuer',
        introHeading: 'Options de valorisation',
        introPreamble: `<p>Le compost à l’échelle de l’immeuble est enfin disponible à la Place Vincent Massey ! Vous disposez maintenant de meilleures options pour détourner vos déchets de bureau !</p>
<ul><li>Détourner au moins 75 % des déchets opérationnels et plastiques de la mise en décharge</li><li>Réduire les émissions de GES d’au moins 40 % pour les installations fédérales</li></ul>
<p>C’est tout à fait réalisable, mais nous avons besoin de votre aide pour mettre les déchets au bon endroit !</p>`,
        introContinue: 'Démarrer le quiz',
        questionPrefix: 'Où doit être trié cet article ? ',
        nextButton: 'Suivant',
        scoreLabel: 'Score : ',
        gameOverHeading: 'Fin du jeu !',
        finalScore: 'Votre score final est : ',
        thankYouMsg: 'Merci d’avoir joué !',
        leaderboardHeading: 'Classement',
        submissionStatusSuccess: 'Vos informations ont été soumises avec succès.',
        submissionStatusError: 'Erreur lors de la soumission.',
        correctText: 'Correct !',
        incorrectText: 'Incorrect ! La bonne réponse est : '
      }
    };

    const questions = [
      { item:{en:'Yogurt Cup',fr:'Coupe de yaourt'}, image:'images/yogurt.jpg', correctAnswers:{en:['Recycle'],fr:['Recycler']} },
      { item:{en:'Pizza Box',fr:'Boîte à pizza'}, image:'images/pizza-box.png', correctAnswers:{en:['Compost'],fr:['Compost']} },
      { item:{en:'Milk Carton',fr:'Carton de lait'}, image:'images/milk-carton.png', correctAnswers:{en:['Recycle'],fr:['Recycler']} },
      { item:{en:'Pop Can',fr:'Canette'}, image:'images/pop-can.png', correctAnswers:{en:['Consignaction Box','Recycle'],fr:['Boîte de consignation','Recycler']} },
      { item:{en:'Aluminum Foil',fr:'Papier d’aluminium'}, image:'images/aluminum-foil.png', correctAnswers:{en:['Recycle'],fr:['Recycler']} },
      { item:{en:'Wine Bottle',fr:'Bouteille de vin'}, image:'images/wine-bottle.png', correctAnswers:{en:['Recycle'],fr:['Recycler']} },
      { item:{en:'Newspapers and Flyers',fr:'Journaux et dépliants'}, image:'images/newspapers.png', correctAnswers:{en:['Recycle'],fr:['Recycler']} },
      { item:{en:'Plastic beverage bottles',fr:'Bouteilles en plastique'}, image:'images/pop-bottles.jpg', correctAnswers:{en:['Consignaction Box','Recycle'],fr:['Boîte de consignation','Recycler']} },
      { item:{en:'Soup can',fr:'Boîte de soupe'}, image:'images/soup.png', correctAnswers:{en:['Recycle'],fr:['Recycler']} },
      { item:{en:'Plastic Wrap, bread bags, ziplocs',fr:'Film plastique, sacs à pain, sacs Ziploc'}, image:'images/bags.png', correctAnswers:{en:['Recycle'],fr:['Recycler']} },
      { item:{en:'Pens, Highlighters, Sharpies',fr:'Stylos, surligneurs, feutres'}, image:'images/writing-utensils.png', correctAnswers:{en:['Office Supplies Box'],fr:['Boîte de fournitures de bureau']} },
      { item:{en:'Juice and Beverage Boxes',fr:'Boîtes de jus et boissons'}, image:'images/juice-box.png', correctAnswers:{en:['Recycle'],fr:['Recycler']} },
      { item:{en:'Chip bags, granola/candy bar wrappers, gum blister pack',fr:'Sachets de chips, emballages de barres, plaquette de gomme'}, image:'images/snack-wrapper.png', correctAnswers:{en:['Snack Wrapper Box'],fr:['Boîte d\'emballages de collation']} },
      { item:{en:'Batteries',fr:'Piles'}, image:'images/batteries.png', correctAnswers:{en:['Battery Box'],fr:['Poubelle pour piles']} },
      { item:{en:'Popsicle Sticks',fr:'Bâtonnets de crème glacée'}, image:'images/popsicle-sticks.png', correctAnswers:{en:['Compost'],fr:['Compost']} },
      { item:{en:'Plastic Coffee Pod',fr:'Capsule de café en plastique'}, image:'images/plastic-coffee-pod.png', correctAnswers:{en:['Coffee Pod Box'],fr:['Boîte à capsules de café']} },
      { item:{en:'Paper Coffee Cup and Lid',fr:'Tasse de café en papier et couvercle'}, image:'images/coffee-cup.png', correctAnswers:{en:['Recycle'],fr:['Recycler']} },
      { item:{en:'Plastic utensils',fr:'Ustensiles en plastique'}, image:'images/plastic-utensils.png', correctAnswers:{en:['Regular Garbage'],fr:['Ordures']} },
      { item:{en:'Styrofoam',fr:'Styromousse'}, image:'images/styrofoam.png', correctAnswers:{en:['Regular Garbage'],fr:['Ordures']} },
      { item:{en:'Coffee grounds and filters',fr:'Marc de café et filtres'}, image:'images/coffee-grounds.png', correctAnswers:{en:['Compost'],fr:['Compost']} },
      { item:{en:'Food leftovers',fr:'Restes alimentaires'}, image:'images/leftovers.png', correctAnswers:{en:['Compost'],fr:['Compost']} },
      { item:{en:'Tea and tea bags',fr:'Thé et sachets de thé'}, image:'images/teabags.png', correctAnswers:{en:['Compost'],fr:['Compost']} },
      { item:{en:'Paper plates (unwaxed)',fr:'Assiettes en papier non cirées'}, image:'images/paper-plates.png', correctAnswers:{en:['Compost'],fr:['Compost']} },
      { item:{en:'Tissue',fr:'Mouchoir'}, image:'images/tissue.png', correctAnswers:{en:['Compost'],fr:['Compost']} },
      { item:{en:'Parchment Paper',fr:'Papier parchemin'}, image:'images/parchment.jpg', correctAnswers:{en:['Compost'],fr:['Compost']} },
      { item:{en:'Disposable water bottle',fr:'Bouteille d\'eau jetable'}, image:'images/water.png', correctAnswers:{en:['Consignaction Box','Recycle'],fr:['Boîte de consignation','Recycler']} }
    ];

    const options = [
      { key:{en:'Recycle',fr:'Recycler'}, img:'images/recycle.png' },
      { key:{en:'Compost',fr:'Compost'}, img:'images/compost.png' },
      { key:{en:'Coffee Pod Box',fr:'Boîte à capsules de café'}, img:'images/coffee-pod-box.png' },
      { key:{en:'Snack Wrapper Box',fr:'Boîte d\'emballages de collation'}, img:'images/snack-wrapper-box.png' },
      { key:{en:'Office Supplies Box',fr:'Boîte de fournitures de bureau'}, img:'images/office-supplies-box.png' },
      { key:{en:'Consignaction Box',fr:'Boîte de consignation'}, img:'images/consignaction-box.png' },
      { key:{en:'Battery Box',fr:'Poubelle pour piles'}, img:'images/battery-box.png' },
      { key:{en:'Regular Garbage',fr:'Ordures'}, img:'images/garbage.png' }
    ];

    let lang='en', idx=0, score=0, shuffled=[];

    function shuffle(arr) { for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

    function applyLanguage() {
      const d=languageData[lang];
      document.getElementById('formHeading').innerText=d.formHeading;
      document.getElementById('labelFirstName').innerText=d.labelFirstName;
      document.getElementById('labelLastName').innerText=d.labelLastName;
      document.getElementById('labelEmail').innerText=d.labelEmail;
      document.getElementById('submitInfo').innerText=d.submitInfo;
      document.getElementById('introHeading').innerText=d.introHeading;
      document.getElementById('introPreamble').innerHTML=d.introPreamble;
      document.getElementById('introContinue').innerText=d.introContinue;
      document.getElementById('nextButton').innerText=d.nextButton;
      document.getElementById('gameOverHeading').innerText=d.gameOverHeading;
      document.getElementById('thankYouMsg').innerText=d.thankYouMsg;
      document.getElementById('leaderboardHeading').innerText=d.leaderboardHeading;
    }

    document.getElementById('langEnglish').onclick=()=>{lang='en'; applyLanguage(); showUserInfo();};
    document.getElementById('langFrench').onclick=()=>{lang='fr'; applyLanguage(); showUserInfo();};

    function showUserInfo() {
      document.getElementById('languageSelection').style.display='none';
      document.getElementById('content').style.display='block';
      document.getElementById('userInfo').style.display='block';
    }

    document.getElementById('userInfoForm').onsubmit=e=>{
      e.preventDefault(); renderDiversionGrid();
      document.getElementById('userInfo').style.display='none';
      document.getElementById('introSection').style.display='block';
    };

    function renderDiversionGrid() {
      const grid=document.getElementById('diversionGrid'); grid.innerHTML='';
      options.forEach(o=>{ const label=o.key[lang]; const card=document.createElement('div'); card.className='diversionCard'; card.innerHTML=`<img src="${o.img}" alt="${label}"><div class="label">${label}</div>`; grid.appendChild(card); });
    }

    document.getElementById('introContinue').onclick=()=>{
      document.getElementById('introSection').style.display='none';
      document.getElementById('gameContainer').style.display='block';
      startQuiz();
    };

    function startQuiz() {
      shuffled=shuffle([...questions]); idx=0; score=0;
      showQuestion(); updateScore();
    }

    function showQuestion() {
      const q=shuffled[idx], d=languageData[lang];
      document.getElementById('questionCounter').innerText=`Question ${idx+1} of ${shuffled.length}`;
      document.getElementById('questionText').innerText=d.questionPrefix + q.item[lang];
      document.getElementById('questionImage').src=q.image;
      const ans=document.getElementById('answers'); ans.innerHTML='';
      options.forEach(o=>{ const lbl=o.key[lang]; const btn=document.createElement('button'); btn.className='answerButton'; btn.innerHTML=`<img src="${o.img}" alt="${lbl}"><div class="label">${lbl}</div>`; btn.onclick=()=>checkAnswer(lbl,q.correctAnswers[lang]); ans.appendChild(btn); });
      document.getElementById('feedback').innerText=''; document.getElementById('nextButton').classList.add('hidden');
    }

    function checkAnswer(sel, correctList) {
      const d=languageData[lang];
      document.querySelectorAll('#answers button').forEach(b=>b.disabled=true);
      const fb=document.getElementById('feedback');
      if(correctList.includes(sel)) { score++; fb.innerText=d.correctText; }
      else { fb.innerText=d.incorrectText + correctList.join(lang==='en'?' or ':' ou '); }
      updateScore();
      const next=document.getElementById('nextButton'); next.classList.remove('hidden');
      next.onclick=()=>{ idx++; if(idx>=shuffled.length) endGame(); else showQuestion(); };
    }

    function updateScore() {
      document.getElementById('score').innerText = languageData[lang].scoreLabel + score;
    }

    async function endGame() {
      const d=languageData[lang];
      document.getElementById('gameContainer').style.display='none';
      document.getElementById('finalSection').style.display='block';
      document.getElementById('finalScore').innerText = d.finalScore + score + ' / ' + shuffled.length;
      try {
        const resp = await fetch(submitUrl, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({
            firstName:document.getElementById('firstName').value,
            lastName:document.getElementById('lastName').value,
            email:document.getElementById('email').value,
            score
          })
        });
        document.getElementById('submissionStatus').innerText = resp.ok ? d.submissionStatusSuccess : d.submissionStatusError;
      } catch(e) {
        document.getElementById('submissionStatus').innerText = d.submissionStatusError;
      }
      loadLeaderboard();
    }

    async function loadLeaderboard() {
      try {
        const resp = await fetch(leaderboardUrl);
        const data = await resp.json();
        const tbody = document.querySelector('#leaderboardTable tbody'); tbody.innerHTML='';
        data.forEach(r=>{
          const tr=document.createElement('tr');
          tr.innerHTML = `<td>${r.firstName} ${r.lastName}</td><td>${r.email}</td><td>${r.score}</td>`;
          tbody.appendChild(tr);
        });
      } catch(e) {}
    }
  </script>
</body>
</html>
