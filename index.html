<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title id="pageTitle">PVM Waste Sort Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      text-align: center;
    }
    #content, #gameContainer, #finalSection { display: none; }
    #feedback { margin-top: 10px; font-weight: bold; }
    .answerButton {
      display: block;
      margin: 10px auto;
      padding: 10px;
      width: 400px;
      text-align: center;
      cursor: pointer;
    }
    #questionImage {
      width: 400px; height: 300px;
      object-fit: cover;
    }
    #score { margin-top: 20px; font-size: 1.2em; }
    #languageSelection { margin-bottom: 20px; }
    table {
      width: 80%; border-collapse: collapse;
      margin: 10px auto;
    }
    table, th, td { border: 1px solid #333; }
    th, td { padding: 8px; text-align: center; }
  </style>
</head>
<body>
  <div id="languageSelection">
    <h2>Select Language / Sélectionnez la langue</h2>
    <button id="langEnglish">English</button>
    <button id="langFrench">Français</button>
  </div>

  <div id="content">
    <div id="userInfo">
      <h2 id="formHeading"></h2>
      <form id="userInfoForm">
        <label id="labelFirstName"></label>
        <input type="text" id="firstName" required><br><br>
        <label id="labelLastName"></label>
        <input type="text" id="lastName" required><br><br>
        <label id="labelEmail"></label>
        <input type="email" id="email" required><br><br>
        <button id="startGameButton" type="submit"></button>
      </form>
    </div>

    <div id="gameContainer">
      <div id="questionSection">
        <h2 id="questionCounter"></h2>
        <img id="questionImage" src="" alt="">
        <h3 id="questionText"></h3>
        <div id="answers"></div>
      </div>
      <div id="feedback"></div>
      <button id="nextButton" class="hidden"></button>
      <div id="score"></div>
    </div>

    <div id="finalSection" class="hidden">
      <h2 id="gameOverHeading"></h2>
      <div id="finalScore"></div>
      <div id="thankYouMsg"></div>
      <h3 id="leaderboardHeading"></h3>
      <div id="leaderboard"></div>
      <div id="submissionStatus"></div>
    </div>
  </div>

  <script>
    const apiBaseUrl = "http://ev-pvm-gt.infinityfreeapp.com/";

    const languageData = {
      en: {
        title: "PVM Waste Sort Game",
        formHeading: "Please enter your information:",
        labelFirstName: "First Name: ",
        labelLastName: "Last Name: ",
        labelEmail: "ECCC Email Address: ",
        startGame: "Start Game",
        questionPrefix: "Where should the following item be sorted? ",
        nextQuestion: "Next Question",
        scoreLabel: "Score: ",
        gameOver: "Game Over!",
        finalScore: "Your final score is: ",
        thankYouMessage: "Thank you for playing!",
        leaderboardHeading: "Leaderboard",
        leaderboardNoData: "No leaderboard data available.",
        submissionSuccess: "Your information has been submitted successfully.",
        submissionError: "There was an error submitting your information.",
        feedbackCorrect: "Correct!",
        feedbackIncorrect: "Incorrect! The correct answer is: ",
        tableHeaderName: "Name",
        tableHeaderScore: "Score",
        bins: [
          "Recycle","Compost","Coffee Pod Box","Snack Wrapper Box",
          "Writing Utensil Box","Consignaction Box","Battery Box","Regular Garbage"
        ],
        questions: [
          { item:"Yogurt Cup",            image:"images/yogurt.jpg",          correctAnswers:["Recycle"] },
          { item:"Pizza Box",             image:"images/pizza-box.png",       correctAnswers:["Compost"] },
          { item:"Milk Carton",           image:"images/milk-carton.png",     correctAnswers:["Recycle"] },
          { item:"Pop Can",               image:"images/pop-can.png",         correctAnswers:["Consignaction Box","Recycle"] },
          { item:"Aluminum Foil",         image:"images/aluminum-foil.png",   correctAnswers:["Recycle"] },
          { item:"Wine Bottle",           image:"images/wine-bottle.png",     correctAnswers:["Recycle"] },
          { item:"Newspapers and Flyers", image:"images/newspapers.png",      correctAnswers:["Recycle"] },
          { item:"Plastic beverage bottles",image:"images/pop-bottles.jpg",  correctAnswers:["Consignaction Box","Recycle"] },
          { item:"Soup can",              image:"images/soup.png",            correctAnswers:["Recycle"] },
          { item:"Plastic Wrap, bread bags, ziplocs",image:"images/bags.png", correctAnswers:["Recycle"] },
          { item:"Pens, Highlighters, Sharpies", image:"images/writing-utensils.png", correctAnswers:["Writing Utensil Box"] },
          { item:"Juice and Beverage Boxes", image:"images/juice-box.png",   correctAnswers:["Recycle"] },
          { item:"Chip bags, granola/candy bar wrappers, gum blister pack", image:"images/snack-wrapper.png", correctAnswers:["Snack Wrapper Box"] },
          { item:"Batteries",            image:"images/batteries.png",        correctAnswers:["Battery Box"] },
          { item:"Popsicle Sticks",      image:"images/popsicle-sticks.png",  correctAnswers:["Compost"] },
          { item:"Plastic Coffee Pod",    image:"images/plastic-coffee-pod.png",correctAnswers:["Coffee Pod Box"] },
          { item:"Paper Coffee Cup and Lid", image:"images/coffee-cup.png", correctAnswers:["Recycle"] },
          { item:"Plastic utensils",     image:"images/plastic-utensils.png", correctAnswers:["Regular Garbage"] },
          { item:"Styrofoam",            image:"images/styrofoam.png",        correctAnswers:["Regular Garbage"] },
          { item:"Coffee grounds and filters", image:"images/coffee-grounds.png", correctAnswers:["Compost"] },
          { item:"Food leftovers",       image:"images/leftovers.png",        correctAnswers:["Compost"] },
          { item:"Tea and tea bags",     image:"images/teabags.png",          correctAnswers:["Compost"] },
          { item:"Paper plates (unwaxed)", image:"images/paper-plates.png",   correctAnswers:["Compost"] },
          { item:"Tissue",               image:"images/tissue.png",           correctAnswers:["Compost"] },
          { item:"Parchment Paper",      image:"images/parchment.jpg",        correctAnswers:["Compost"] },
          { item:"Disposable water bottle", image:"images/water.png",        correctAnswers:["Consignaction Box","Recycle"] }
        ]
      },
      fr: {
        title: "Jeu de tri des déchets PVM",
        formHeading: "Veuillez entrer vos informations :",
        labelFirstName: "Prénom : ",
        labelLastName: "Nom de famille : ",
        labelEmail: "Adresse courriel ECCC : ",
        startGame: "Démarrer le jeu",
        questionPrefix: "Où doit être trié cet article ? ",
        nextQuestion: "Question suivante",
        scoreLabel: "Score : ",
        gameOver: "Fin du jeu !",
        finalScore: "Votre score final est : ",
        thankYouMessage: "Merci d'avoir joué !",
        leaderboardHeading: "Tableau des scores",
        leaderboardNoData: "Aucune donnée disponible pour le tableau des scores.",
        submissionSuccess: "Vos informations ont été soumises avec succès.",
        submissionError: "Une erreur est survenue lors de la soumission de vos informations.",
        feedbackCorrect: "Correct !",
        feedbackIncorrect: "Incorrect ! La bonne réponse est : ",
        tableHeaderName: "Nom",
        tableHeaderScore: "Score",
        bins: [
          "Recycle","Compost","Boîte à capsules de café","Boîte d'emballages de collation",
          "Boîte à ustensiles d'écriture","Boîte de consignation","Poubelle pour batteries","Ordures"
        ],
        questions: [
          { item:"Coupe de yaourt",            image:"images/yogurt.jpg",          correctAnswers:["Recycle"] },
          { item:"Boîte à pizza",               image:"images/pizza-box.png",       correctAnswers:["Compost"] },
          { item:"Carton de lait",              image:"images/milk-carton.png",     correctAnswers:["Recycle"] },
          { item:"Canette",                     image:"images/pop-can.png",         correctAnswers:["Boîte de consignation","Recycle"] },
          { item:"Papier aluminium",            image:"images/aluminum-foil.png",   correctAnswers:["Recycle"] },
          { item:"Bouteille de vin",            image:"images/wine-bottle.png",     correctAnswers:["Recycle"] },
          { item:"Journaux et dépliants",       image:"images/newspapers.png",      correctAnswers:["Recycle"] },
          { item:"Bouteilles en plastique pour boissons", image:"images/pop-bottles.jpg", correctAnswers:["Boîte de consignation","Recycle"] },
          { item:"Boîte de soupe",              image:"images/soup.png",            correctAnswers:["Recycle"] },
          { item:"Emballages plastiques, sacs de pain, sacs ziploc", image:"images/bags.png", correctAnswers:["Recycle"] },
          { item:"Stylos, surligneurs, feutres", image:"images/writing-utensils.png",correctAnswers:["Boîte à ustensiles d'écriture"] },
          { item:"Boîtes de jus et de boissons", image:"images/juice-box.png",      correctAnswers:["Recycle"] },
          { item:"Sachets de chips, emballages de barres granola/candy, sacs ziploc, blister de chewing-gum", image:"images/snack-wrapper.png", correctAnswers:["Boîte d'emballages de collation"] },
          { item:"Batteries",                   image:"images/batteries.png",        correctAnswers:["Poubelle pour batteries"] },
          { item:"Bâtonnets glacés",            image:"images/popsicle-sticks.png",  correctAnswers:["Compost"] },
          { item:"Capsule de café en plastique", image:"images/plastic-coffee-pod.png",correctAnswers:["Boîte à capsules de café"] },
          { item:"Tasse de café en carton et couvercle", image:"images/coffee-cup.png", correctAnswers:["Recycle"] },
          { item:"Couverts en plastique",       image:"images/plastic-utensils.png", correctAnswers:["Ordures"] },
          { item:"Polystyrène",                 image:"images/styrofoam.png",        correctAnswers:["Ordures"] },
          { item:"Marcs et filtres à café",     image:"images/coffee-grounds.png",   correctAnswers:["Compost"] },
          { item:"Restes alimentaires",         image:"images/leftovers.png",        correctAnswers:["Compost"] },
          { item:"Thé et sachets de thé",       image:"images/teabags.png",          correctAnswers:["Compost"] },
          { item:"Assiettes en carton (non cirées)", image:"images/paper-plates.png", correctAnswers:["Compost"] },
          { item:"Mouchoirs en papier",         image:"images/tissue.png",           correctAnswers:["Compost"] },
          { item:"Papier parchemin",            image:"images/parchment.jpg",        correctAnswers:["Compost"] },
          { item:"Bouteille d'eau en plastique jetable", image:"images/water.png", correctAnswers:["Boîte de consignation","Recycle"] }
        ]
      }
    };

    let currentLang, currentText, currentQuestionIndex, score, userInfo, shuffledQuestions;

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function applyLanguage() {
      document.getElementById("pageTitle").innerText = currentText.title;
      document.getElementById("formHeading").innerText = currentText.formHeading;
      document.getElementById("labelFirstName").innerText = currentText.labelFirstName;
      document.getElementById("labelLastName").innerText = currentText.labelLastName;
      document.getElementById("labelEmail").innerText = currentText.labelEmail;
      document.getElementById("startGameButton").innerText = currentText.startGame;
      document.getElementById("nextButton").innerText = currentText.nextQuestion;
      document.getElementById("gameOverHeading").innerText = currentText.gameOver;
      document.getElementById("score").innerText = currentText.scoreLabel + score;
      document.title = currentText.title;
    }

    function loadQuestion() {
      document.getElementById("feedback").innerText = "";
      document.getElementById("nextButton").classList.add("hidden");
      if (currentQuestionIndex >= shuffledQuestions.length) return endGame();
      const q = shuffledQuestions[currentQuestionIndex];
      document.getElementById("questionCounter").innerText = `Question ${currentQuestionIndex+1} of ${shuffledQuestions.length}`;
      document.getElementById("questionText").innerText = currentText.questionPrefix + q.item;
      document.getElementById("questionImage").src = q.image;
      const answersDiv = document.getElementById("answers");
      answersDiv.innerHTML = "";
      currentText.bins.forEach(bin => {
        const btn = document.createElement("button");
        btn.className = "answerButton";
        btn.innerText = bin;
        btn.onclick = () => checkAnswer(bin);
        answersDiv.appendChild(btn);
      });
      document.getElementById("score").innerText = currentText.scoreLabel + score;
    }

    function checkAnswer(choice) {
      const q = shuffledQuestions[currentQuestionIndex];
      const feedback = document.getElementById("feedback");
      document.querySelectorAll("#answers button").forEach(b=>b.disabled=true);
      if (q.correctAnswers.includes(choice)) {
        feedback.innerText = currentText.feedbackCorrect;
        score++;
      } else {
        feedback.innerText = currentText.feedbackIncorrect + q.correctAnswers.join(" or ");
      }
      document.getElementById("nextButton").classList.remove("hidden");
      document.getElementById("score").innerText = currentText.scoreLabel + score;
    }

    function endGame() {
      document.getElementById("gameContainer").style.display = "none";
      document.getElementById("finalSection").classList.remove("hidden");
      document.getElementById("finalScore").innerText = currentText.finalScore + score + " out of " + shuffledQuestions.length;
      document.getElementById("thankYouMsg").innerText = currentText.thankYouMessage;
      fetch(apiBaseUrl + "submit.php", {
        method:"POST", headers:{"Content-Type":"application/json"},
        body:JSON.stringify({firstName:userInfo.firstName,lastName:userInfo.lastName,email:userInfo.email,score})
      })
      .then(r=>r.json()).then(_=>{
        document.getElementById("submissionStatus").innerText = currentText.submissionSuccess;
        return fetch(apiBaseUrl + "leaderboard.php");
      })
      .then(r=>r.json()).then(displayLeaderboard)
      .catch(e=>{
        document.getElementById("submissionStatus").innerText = currentText.submissionError;
        console.error(e);
      });
    }

    function displayLeaderboard(data) {
      const div = document.getElementById("leaderboard");
      if (!data.length) {
        div.innerText = currentText.leaderboardNoData;
        return;
      }
      let html = `<table><tr><th>${currentText.tableHeaderName}</th><th>${currentText.tableHeaderScore}</th></tr>`;
      data.forEach(e=>{
        html += `<tr><td>${e.firstName} ${e.lastName}</td><td>${e.score}</td></tr>`;
      });
      html += "</table>";
      div.innerHTML = html;
    }

    document.getElementById("nextButton").onclick = ()=>{currentQuestionIndex++;loadQuestion()};
    document.getElementById("userInfoForm").onsubmit = e=>{
      e.preventDefault();
      userInfo={ firstName:document.getElementById("firstName").value,
                 lastName: document.getElementById("lastName").value,
                 email:    document.getElementById("email").value };
      document.getElementById("userInfo").style.display="none";
      document.getElementById("gameContainer").style.display="block";
      loadQuestion();
    };
    document.getElementById("langEnglish").onclick = ()=>{ currentLang="en";currentText=languageData.en;startGame() };
    document.getElementById("langFrench").onclick  = ()=>{ currentLang="fr";currentText=languageData.fr;startGame() };

    function startGame(){
      document.getElementById("languageSelection").style.display="none";
      document.getElementById("content").style.display="block";
      currentQuestionIndex=0;score=0;
      shuffledQuestions=shuffle([...currentText.questions]);
      applyLanguage();loadQuestion();
    }
  </script>
</body>
</html>
